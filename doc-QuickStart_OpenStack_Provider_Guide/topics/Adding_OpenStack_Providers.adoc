== Adding an OpenStack Cloud Provider

{product-title} supports operating with the OpenStack `admin` tenant.
When creating an OpenStack provider in {product-title}, select the OpenStack provider's `admin` user because it is the default administrator of the OpenStack `admin` tenant.
When using the `admin` credentials, a user in {product-title} provisions into the `admin` tenant, and sees images, networks, and instances that are associated with the `admin` tenant. 

. Navigate to menu:Clouds[Providers]. 
. Click  image:1847.png[] (*Configuration*), then click  image:1848.png[] (*Add a New Cloud Provider*). 
. Enter a *Name* for the provider. 
. From the *Type* drop down menu select *OpenStack*. 
. Enter the *Host Name (or IPv4 or IPv6 address)* of the provider. 
+
IMPORTANT: The *Host Name* must use a unique fully qualified domain name. 

. Enter the *API Port* of your Keystone service. 
  The default port is `5000`. 
+
IMPORTANT: If the Keystone service is configured to use SSL, you must enter the SSL port for Keystone. 

. Select the appropriate *API Version* from the list. The default is `Keystone v2`. 
. Select the appropriate *Zone* for the provider.
  By default, the zone is set to *default*. 
. In the *Credentials* area, under *Default*, provide the login credentials required for the Keystone user: 
+
IMPORTANT: To enable discovery of OpenStack cloud providers, ensure that the `iptables` for the OpenStack host providing Keystone services allows port 5000 access to all hosts on the same network. 
+
* Enter the user name in the *Username* field. 
* Enter the user password in the *Password* field. 
* Confirm the user password in the *Confirm Password* field. 
* Click *Validate* to confirm {product-title} can connect to the OpenStack Infrastructure instance. 

. You can use AMPQ if ceilometer is not configured for _Events_. If AMQP credentials were changed during the OpenStack provider install, use the *AMQP* tab of the *Credentials* area to provide the login credentials required for the Advanced Message Queuing Protocol messaging service on your OpenStack Nova component: 
+
* Enter the administrative user name in the *Username* field. 
* Enter the user password in the *Password* field. 
* Confirm the user password in the *Confirm Password* field. 
* Click *Validate* to confirm {product-title} can connect to the messaging service. 
+
[NOTE]
======
To enable ceilometer to store events sent by OpenStack services, you will need to configure the following:

* Undercloud - Before running 'openstack undercloud install', edit 'undercloud.conf' by setting 'store_events' to 'true'.
* Overcloud - On your controller, create an additional environment file called 'ceilometer.yaml' with the following options:

----
parameter_defaults:
  CeilometerStoreEvents: true
----

Then, add this environment file to the `overcloud deploy` command, for example:

----
openstack overcloud deploy --templates -e ~/ceilometer.yaml
----
======
+
. Click *Add*. 

[NOTE]
======
In order to collect inventory and metrics from an OpenStack environment, the {product-title} Appliance requires that the adminURL endpoint for the OpenStack environment should be on a non-private network.
Hence, the OpenStack adminURL endpoint should be assigned an IP address other than `192.168.x.x`. Additionally, make sure that all the Keystone endpoints must be accessbile, otherwise refresh will fail.
======

[NOTE]
======
For {product-title} to be able to receive events from a Red Hat OpenStack provider, the OpenStack configuration file must be modified. Specifically, the *notification_driver* field must be defined.

For Nova and Heat, in order to start getting notifications, manually change the configuration files as below and restart services.

------
/etc/heat/heat.conf
notification_driver=glance.openstack.common.notifier.rpc_notifier
notification_topics=notifications
------

------
/etc/nova/nova.conf
notification_driver=messaging
notification_topics=notifications
------
======

